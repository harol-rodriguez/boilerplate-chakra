'use client';
import { Box, Container, HStack, Heading, Stack, Text, Image, Flex } from '@chakra-ui/react';
import { useMotionValue, useScroll, useVelocity, useSpring, useTransform, wrap, useAnimationFrame, motion } from 'framer-motion';
import { useRef } from 'react';
import "./stack.style.css";
import ParallaxText from '@/shared/components/parallaxSroll';
import { useKeenSlider } from 'keen-slider/react';

const MotionBox = motion(Box);
const MotionFlex = motion(Flex);
const StackSection = () => {
  const animation = { duration: 20000, easing: (t: number) => t }
  const [sliderRef] = useKeenSlider<HTMLDivElement>({
    mode: 'free-snap',
    loop: true,
    slides: {
      origin: 'center',
      perView: 4.5,
      spacing: 15,
    },
    created(s) {
      s.moveToIdx(5, true, animation)
    },
    updated(s) {
      s.moveToIdx(s.track.details.abs + 5, true, animation)
    },
    animationEnded(s) {
      s.moveToIdx(s.track.details.abs + 5, true, animation)
    },
  })

  return (
    <Box bg="gray.800">
      <Container as="section" pt="0" pb={10}>
        <Stack gap="10">
          <HStack align="center">
            <Heading as="h3" size="2xl" fontWeight="500" color="white">We work with the most powerful technologies of the moment.</Heading>
            <Text color="whiteAlpha.600">We adapt to your requirements and technological objectives.</Text>
          </HStack>
        </Stack>

      </Container>

      <Flex
        position="relative"
        as="section"
        ref={sliderRef}
        className="keen-slider" py={10} pb={16}
      >
        {
          [1,1,1,1,1].map((d,i) => (
            <Box
              position="relative"
              className="keen-slider__slide"
              key={i} 
              style={{ width: '300px', height: '80px', backgroundColor: 'blackAlpha.300' }}
            >
              <BrandSlide />
            </Box>
          ))
        }
      </Flex>

      <Box>
        <Image w="100vw" h="70vh" objectFit="cover" src="https://images.unsplash.com/photo-1527192491265-7e15c55b1ed2?q=80&w=3540&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="" />
      </Box>
    </Box>
  );
};

export default StackSection;


const BrandSlide = ({ index }:any) => {
  const ref = useRef(null);
  const { scrollYProgress } = useScroll({
    target: ref,
    offset: ["end end", "start start"]
  });

  const scale = useTransform(scrollYProgress, [0, 0.25, 1], [0.4, 1, 1.5]);

  return (
    <MotionFlex ref={ref} style={{ scale }} opacity="1" position="relative" justify="center" align="center" h="100%">
      <svg width="72" height="44" viewBox="0 0 72 44" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g clipPath="url(#clip0_2106_3045)">
        <path d="M20.36 15.9429C20.36 16.8451 20.4556 17.5764 20.6224 18.1127C20.8342 18.7161 21.0891 19.3028 21.3852 19.8678C21.5044 20.0628 21.552 20.2578 21.552 20.4286C21.552 20.6722 21.4091 20.9161 21.0991 21.1599L19.5973 22.1837C19.3827 22.3301 19.1681 22.4032 18.9771 22.4032C18.7389 22.4032 18.5004 22.2812 18.2619 22.0618C17.9407 21.7088 17.6534 21.3252 17.4038 20.9161C17.1653 20.502 16.9268 20.0384 16.6647 19.4779C14.805 21.7204 12.4684 22.842 9.65536 22.842C7.65286 22.842 6.05536 22.2568 4.88705 21.0869C3.71902 19.9164 3.12305 18.3563 3.12305 16.4062C3.12305 14.3342 3.83827 12.6521 5.29261 11.3845C6.74667 10.1168 8.67802 9.48298 11.1336 9.48298C11.9442 9.48298 12.7786 9.55602 13.6606 9.67796C14.5429 9.79989 15.4488 9.99487 16.4025 10.2143V8.43474C16.4025 6.58185 16.0209 5.29004 15.2818 4.53427C14.519 3.77851 13.2315 3.4127 11.3957 3.4127C10.5613 3.4127 9.70317 3.51048 8.82089 3.7299C7.93889 3.94904 7.08052 4.21736 6.24605 4.55871C5.86467 4.72925 5.57864 4.82674 5.41158 4.87563C5.2448 4.92452 5.12555 4.94868 5.0302 4.94868C4.69636 4.94868 4.52958 4.70481 4.52958 4.19291V2.9983C4.52958 2.60834 4.57739 2.31587 4.69636 2.14533C4.81561 1.97451 5.0302 1.80397 5.36405 1.63343C6.19852 1.19458 7.19977 0.82878 8.3678 0.536309C9.53639 0.219394 10.7761 0.073303 12.0873 0.073303C14.9246 0.073303 16.9988 0.73129 18.3339 2.04784C19.6451 3.3641 20.3128 5.36308 20.3128 8.04478V15.9429H20.36ZM10.6805 19.6484C11.4675 19.6484 12.278 19.5023 13.1361 19.2096C13.9945 18.9171 14.7575 18.3808 15.401 17.6494C15.7827 17.1864 16.0687 16.6745 16.2116 16.0893C16.3547 15.5044 16.4501 14.7972 16.4501 13.9684V12.9446C15.7271 12.7647 14.9948 12.6263 14.2566 12.5302C13.5133 12.4337 12.7649 12.3848 12.0156 12.3838C10.4181 12.3838 9.25008 12.7007 8.46342 13.359C7.67648 14.0173 7.29511 14.9436 7.29511 16.1623C7.29511 17.3081 7.58114 18.1613 8.17711 18.7466C8.74945 19.3559 9.58392 19.6484 10.6805 19.6484ZM29.8249 22.2812C29.3957 22.2812 29.1097 22.2082 28.919 22.0374C28.7283 21.8913 28.5613 21.5499 28.4184 21.0869L22.8159 2.24282C22.6725 1.75508 22.601 1.43817 22.601 1.26763C22.601 0.877669 22.7917 0.657957 23.1734 0.657957H25.5097C25.9625 0.657957 26.2727 0.73129 26.4395 0.901826C26.6302 1.0482 26.7734 1.38956 26.9162 1.85257L30.9215 17.9908L34.6408 1.85257C34.76 1.36512 34.9032 1.0482 35.0936 0.901826C35.2845 0.755734 35.6184 0.658244 36.0476 0.658244H37.9547C38.4076 0.658244 38.7178 0.73129 38.9082 0.901826C39.0991 1.0482 39.2659 1.38956 39.3613 1.85257L43.1283 18.1858L47.2526 1.85257C47.3955 1.36512 47.5625 1.0482 47.7293 0.901826C47.92 0.755734 48.2299 0.658244 48.6591 0.658244H50.8762C51.2579 0.658244 51.4725 0.853225 51.4725 1.26763C51.4725 1.38956 51.4485 1.5115 51.4246 1.65759C51.4007 1.80397 51.3532 1.99895 51.2579 2.26726L45.5119 21.1111C45.369 21.5988 45.2023 21.9157 45.0113 22.0618C44.8206 22.2082 44.5107 22.3057 44.1057 22.3057H42.0554C41.6023 22.3057 41.2923 22.2326 41.1014 22.0618C40.9107 21.8913 40.7439 21.5743 40.6486 21.0869L36.9529 5.36308L33.2815 21.0622C33.1625 21.5499 33.0194 21.8668 32.8287 22.0374C32.638 22.2082 32.3041 22.2812 31.8752 22.2812H29.8249ZM60.4606 22.9395C59.2209 22.9395 57.9811 22.7931 56.7892 22.5007C55.597 22.2082 54.6675 21.891 54.0476 21.5257C53.6659 21.306 53.4035 21.0625 53.3085 20.843C53.2156 20.6279 53.1669 20.3955 53.1653 20.1603V18.9171C53.1653 18.4052 53.356 18.1613 53.7137 18.1613C53.8597 18.1619 54.0047 18.1866 54.1429 18.2347C54.2858 18.2836 54.5004 18.3808 54.7389 18.4782C55.5809 18.857 56.46 19.143 57.3613 19.3315C58.2951 19.5253 59.2456 19.6233 60.1985 19.624C61.7004 19.624 62.8687 19.3559 63.6793 18.8196C64.4898 18.2833 64.919 17.5033 64.919 16.5037C64.919 15.8213 64.7044 15.2605 64.2752 14.7972C63.8461 14.3342 63.0355 13.9198 61.8675 13.5295L58.4103 12.4327C56.67 11.8719 55.3827 11.0431 54.5957 9.94598C53.8091 8.8733 53.4038 7.67898 53.4038 6.41132C53.4038 5.38753 53.6184 4.48538 54.0476 3.70517C54.4765 2.92525 55.0488 2.24282 55.764 1.70648C56.4793 1.1457 57.2898 0.73129 58.2435 0.438819C59.197 0.146349 60.1982 0.0244141 61.2473 0.0244141C61.7718 0.0244141 62.3203 0.0488585 62.8448 0.121904C63.3932 0.19495 63.8939 0.29244 64.3945 0.38993C64.8712 0.511865 65.3243 0.6338 65.7535 0.780179C66.1827 0.92627 66.5162 1.07265 66.7547 1.21874C67.0886 1.41401 67.3268 1.60899 67.47 1.82841C67.6131 2.02339 67.6845 2.29142 67.6845 2.63278V3.77851C67.6845 4.2904 67.4939 4.55871 67.1361 4.55871C66.9454 4.55871 66.6355 4.46094 66.2305 4.26596C64.8712 3.63213 63.3454 3.31521 61.6529 3.31521C60.2939 3.31521 59.2209 3.53464 58.4818 3.99793C57.7429 4.46094 57.3613 5.1681 57.3613 6.16745C57.3613 6.85017 57.5998 7.43511 58.0765 7.8984C58.5535 8.36141 59.4355 8.8247 60.6991 9.23911L64.0845 10.3362C65.801 10.897 67.0408 11.6769 67.7799 12.6763C68.519 13.6759 68.8768 14.8216 68.8768 16.0893C68.8768 17.1375 68.6619 18.0883 68.2566 18.9171C67.8277 19.7459 67.2554 20.4772 66.5162 21.0625C65.7771 21.6718 64.8951 22.1107 63.87 22.4276C62.797 22.769 61.6765 22.9395 60.4606 22.9395Z" fill="white"/>
        <path d="M64.9666 34.7872C57.1231 40.7111 45.7269 43.8558 35.9284 43.8558C22.1958 43.8558 9.82247 38.6632 0.476815 30.0334C-0.26231 29.351 0.405097 28.4247 1.2871 28.9608C11.3958 34.958 23.8647 38.5901 36.7628 38.5901C45.4647 38.5901 55.025 36.7375 63.8225 32.9346C65.1337 32.3249 66.2542 33.8123 64.9666 34.7872ZM68.233 30.9842C67.2318 29.6679 61.6051 30.3504 59.0542 30.6673C58.2911 30.765 58.1719 30.0823 58.8635 29.5704C63.3455 26.3524 70.7125 27.279 71.5706 28.3514C72.429 29.4485 71.3321 36.9811 67.1362 40.5891C66.4927 41.1499 65.8728 40.8574 66.1588 40.1261C67.1123 37.7124 69.2343 32.2763 68.233 30.9842Z" fill="#FF9900"/>
        </g>
        <defs>
        <clipPath id="clip0_2106_3045">
        <rect width="72" height="44" fill="white"/>
        </clipPath>
        </defs>
      </svg>

    </MotionFlex>
  );
};

